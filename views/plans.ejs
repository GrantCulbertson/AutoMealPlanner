<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/public/styles.css" rel="stylesheet">
</head>
<body class="bg-body">
  <nav class="navbar navbar-expand-lg navbar-dark bg-darkgray mb-4">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/">AutoMeal Planner</a>
      <div>
        <a class="btn btn-outline-light" href="/">New Plan</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-12 col-xl-10">
        <h3 class="mb-3">Your Weekly Grocery Lists & Meal Plans</h3>
        <% if (!plans || plans.length === 0) { %>
          <div class="alert alert-info">No plans yet. Create one from the home page.</div>
        <% } %>

        <% plans.forEach(function(p) { %>
          <div class="card shadow-sm mb-4">
            <div class="card-header d-flex flex-wrap justify-content-between align-items-center">
              <div>
                <span class="badge bg-sage me-2">Generated</span>
                <strong><%= new Date(p.createdAt).toLocaleString() %></strong>
              </div>
              <div class="text-muted small">
                Budget: $<%= p.input.weeklyBudgetUsd %> · Store: <%= p.input.groceryStore %> · Complexity: <%= p.input.complexity %>
              </div>
            </div>
            <div class="card-body">
              <div class="row g-4">
                <div class="col-md-5">
                  <h5>Grocery List</h5>
                  <ul class="list-group">
                    <% (p.plan.grocery_list || []).forEach(function(item) { %>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><%= item.item || item.name %></span>
                        <span class="badge bg-darkgray"><%= item.quantity || '' %></span>
                      </li>
                    <% }) %>
                  </ul>
                </div>
                <div class="col-md-7">
                  <h5>Weekly Plan</h5>
                  <div class="accordion" id="accordion<%= p.id %>">
                    <% (p.plan.weekly_plan || []).forEach(function(day, idx) { %>
                      <div class="accordion-item">
                        <h2 class="accordion-header" id="heading<%= p.id %>_<%= idx %>">
                          <button class="accordion-button <%= idx !== 0 ? 'collapsed' : '' %>" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= p.id %>_<%= idx %>" aria-expanded="<%= idx === 0 ? 'true' : 'false' %>" aria-controls="collapse<%= p.id %>_<%= idx %>">
                            <%= day.day || ('Day ' + (idx + 1)) %>
                          </button>
                        </h2>
                        <div id="collapse<%= p.id %>_<%= idx %>" class="accordion-collapse collapse <%= idx === 0 ? 'show' : '' %>" aria-labelledby="heading<%= p.id %>_<%= idx %>" data-bs-parent="#accordion<%= p.id %>">
                          <div class="accordion-body">
                            <div class="row">
                              <div class="col-md-4">
                                <div class="meal">
                                  <div class="meal-label">Breakfast</div>
                                  <div class="meal-title"><%= day.breakfast?.title %></div>
                                  <div class="meal-desc"><%= day.breakfast?.instructions %></div>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="meal">
                                  <div class="meal-label">Lunch</div>
                                  <div class="meal-title"><%= day.lunch?.title %></div>
                                  <div class="meal-desc"><%= day.lunch?.instructions %></div>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="meal">
                                  <div class="meal-label">Dinner</div>
                                  <div class="meal-title"><%= day.dinner?.title %></div>
                                  <div class="meal-desc"><%= day.dinner?.instructions %></div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    <% }) %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </div>
  </div>

  <footer class="text-center mt-5 mb-4 text-muted small">
    Built with ❤️ using Node.js, Express, and EJS
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

